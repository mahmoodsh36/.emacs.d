\usepackage[margin=0.2in]{geometry}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{indentfirst}
\usepackage{pgffor}
\usepackage{amssymb}
\usepackage{pifont}
\usepackage{cancel}
\usepackage{amsthm}
\usepackage{polynom}
\usepackage{tikz}
\usepackage[tikz]{bclogo}
\usepackage{listings}
\usepackage[most]{tcolorbox}
\usepackage{forest}
\usepackage{adjustbox}
\usepackage{tikz-3dplot}
\usepackage{mathtools}
\usepackage{pgfplots}
\usetikzlibrary{tikzmark,calc,fit,matrix,arrows,automata,positioning,angles,quotes,trees,graphs,backgrounds,intersections,arrows.meta,bbox}
\usepgfplotslibrary{fillbetween}
\usepackage{centernot}
\usepackage{lmodern}
\usepackage{physics}
% \usepackage{physics2}
\usepackage[linesnumbered,vlined]{algorithm2e}
\usepackage{algpseudocode}
\usepackage{algorithmicx}
% \usepackage{svg}
% \usepackage{karnaugh-map}
\usepackage{karnaughmap}
\usepackage{bm}
\usepackage{circuitikz}
\usepackage{listofitems}
\usepackage{proof}
% dont enable this its horrible, makes rendering from org-babel not work properly
% \tikzstyle{every picture}+=[remember picture]
\usepackage{enumitem}
\usepackage{caption}
\usepackage{iftex}
\usepackage{turnstile}
\usepackage[normalem]{ulem}
\usepackage{ifthen}
\usepackage{xifthen}
\usepackage{xparse}
\usepackage{pdfpages}
\usepackage{relsize} % for \mathsmaller, \mathlarger
\usepackage{fonttable}
% \usepackage{breqn}
\ifLuaTeX
% graphdrawing library is only available to luatex
\usetikzlibrary{graphdrawing}
\usegdlibrary{force, trees, layered}
\usepackage{unicode-math} % only usable with lualatex
\newcommand\brm[1]{\symbf{#1}} % this one symbf from unicode-math works with all symbols, so far (requires lualatex)
\else
\newcommand\brm[1]{\bm{\mathrm{#1}}} % \bv isnt universal
\fi
% \usepackage{kpfonts} % better looking fonts
\usepackage{txfonts} % im using \varv from here

% a dummy environment to group together "stuff"
\newenvironment*{dummyenv}{}{}
\newenvironment*{dummy}{}{}

% matrix derivative notation for vector calculus
\newcommand{\matderiv}[2][]{%
  \ifthenelse{\equal{#1}{}}
    {\ensuremath{\left[\brm{D}#2\right]}}% if #1 is empty
    {\ensuremath{\left[\brm{D}_{#1}#2\right]}}% if #2,#1 not empty
}

% no space before paragraph (is this desired?)
% \setlength{\parindent}{0pt}

% some needed operators to not lose my sanity
\DeclareMathOperator{\spn}{span}
\DeclareMathOperator{\dom}{domain}
\DeclareMathOperator{\ran}{range}
\DeclareMathOperator{\rng}{range}
\DeclareMathOperator{\img}{Im}
\DeclareMathOperator{\adj}{adj}
\DeclareMathOperator{\Var}{Var}
\DeclareMathOperator{\cov}{cov}
\newcommand\dif[1]{\:\mathrm{d}#1}
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}
% apparently the physics package has the \rank operator so i dont gotta define it.
% \DeclareMathOperator{\rank}{rank}
\newcommand{\ihat}{\hat{\textbf{\i}}}
\newcommand{\jhat}{\hat{\textbf{\j}}}
\newcommand{\khat}{\hat{\textbf{k}}}
\newcommand{\rhat}{\hat{\textbf{r}}}
\newcommand{\thetahat}{\boldsymbol{\hat{\theta}}}
\newcommand{\?}{\stackrel{?}{=}}
\newcommand{\cmark}{\text{\ding{51}}}
\newcommand{\xmark}{\text{\ding{55}}}
\renewcommand{\Pr}{\bm{\mathrm{P}}}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator{\vct}{vec}
\newcommand*{\defeq}{\stackrel{\text{def}}{=}} % def on top of equal sign
\DeclareMathOperator{\expc}{\mathbb{E}} % expected value symbol
\DeclareMathOperator{\Mat}{Mat} % Mat symbol for sets of matrices of specific dimensions
\newcommand{\inpr}[2]{\langle #1, #2 \rangle} % inner product symbols, consider also physics' \braket

% some symbols for cryptography notation (Gen,Enc,Dec)
\DeclareMathOperator{\Gen}{Gen}
\DeclareMathOperator{\Enc}{Enc}
\DeclareMathOperator{\Dec}{Dec}

% some symbols for relational algebra
\def\ojoin{\setbox0=\hbox{$\bowtie$}%
  \rule[-.02ex]{.25em}{.4pt}\llap{\rule[\ht0]{.25em}{.4pt}}}
\def\leftouterjoin{\mathbin{\ojoin\mkern-5.8mu\bowtie}}
\def\rightouterjoin{\mathbin{\bowtie\mkern-5.8mu\ojoin}}
\def\fullouterjoin{\mathbin{\ojoin\mkern-5.8mu\bowtie\mkern-5.8mu\ojoin}}

% lst
\definecolor{Brown}{cmyk}{0,0.81,1,0.60}
\definecolor{OliveGreen}{cmyk}{0.64,0,0.95,0.40}
\definecolor{CadetBlue}{cmyk}{0.62,0.57,0.23,0}
\definecolor{lightlightgray}{gray}{0.9}
\lstset{
  language=C,                             % Code langugage
  basicstyle=\ttfamily,                   % Code font, Examples: \footnotesize, \ttfamily
  keywordstyle=\color{OliveGreen},        % Keywords font ('*' = uppercase)
  commentstyle=\color{gray},              % Comments font
  numbers=left,                           % Line nums position
  numberstyle=\tiny,                      % Line-numbers fonts
  stepnumber=1,                           % Step between two line-numbers
  numbersep=5pt,                          % How far are line-numbers from code
  backgroundcolor=\color{lightlightgray}, % Choose background color
  tabsize=2,                              % Default tab size
  captionpos=t,                           % Caption-position = bottom
  breaklines=true,                        % Automatic line breaking?
  breakatwhitespace=false,                % Automatic breaks only at whitespace?
  showspaces=false,                       % Dont make spaces visible
  showtabs=false,                         % Dont make tabls visible
  % columns=flexible,                       % Column format
  morekeywords={__global__, __device__},   % CUDA specific keywords
  showstringspaces=false,                 % dont show spaces in strings
  frame=shadowbox,
}
% so that latex doesnt complain about sage not being a language
\lstdefinelanguage{sage}{}

% environment definition for special blocks
\theoremstyle{definition}
\newtheorem{my_example}{example}
\counterwithin{my_example}{section}
\counterwithin{my_example}{subsection}
\newtheorem{definition}{definition}
\counterwithin{definition}{section}
\counterwithin{definition}{subsection}
\newtheorem{characteristic}{characteristic}
\newtheorem{entailment}{entailment}
\newtheorem{corollary}{corollary}
%\newtheore*{proof}{Proof}
\newtheorem{lemma}{lemma}
\newtheorem{question}{question}
\newtheorem{remark}{remark}
\newtheorem{subquestion}{subquestion}[question]
%\newtheorem{note}{Note}
\newtheorem{answer}{answer}
\counterwithin{answer}{question}
\counterwithin{answer}{subquestion}
\newtheorem{step}{step}[answer]
\newtheorem{problem}{problem}
\newtheorem{solution}{solution}[problem]
\newtheorem{subproblem}{subproblem}[problem]
\newtheorem{thought}{thought}
\newtheorem{task}{task}
\newtheorem{theorem}{theorem}

% the following snippet auto resizes images to fit properly
% Determine if the image is too wide for the page.
% \makeatletter
% \def\ScaleIfNeeded{%
%   \ifdim\Gin@nat@width>\linewidth
%     \linewidth
%   \else
%     \Gin@nat@width
%   \fi
% }
% \makeatother
% % Resize figures that are too wide for the page.
% \let\oldincludegraphics\includegraphics
% \renewcommand\includegraphics[2][]{%
%   \oldincludegraphics[width=\ScaleIfNeeded]{#2}
% }

% brace to group lines of code for a quote
\newcommand*{\addbrace}[4]{%
    \begin{tikzpicture}[overlay, remember picture]
        \draw[decoration={brace,amplitude=0.5em}, decorate, thick]
            ($(#3)!(#1.north)!($(#3)-(0,1)$)$) --
            ($(#3)!(#2.south)!($(#3)-(0,1)$)$)
                node[right=0.2cm, text width=5cm, pos=0.5, anchor=west] {#4};
    \end{tikzpicture}
}%

\newenvironment{note}
  {\begin{bclogo}[logo=\bcinfo, couleurBarre=orange, couleur=lightgray]{ note}}
  {\end{bclogo}}
\newenvironment{attention}
  {\begin{bclogo}[logo=\bcattention, couleurBarre=red, noborder=true, 
                couleur=red!15]{Important!}}
  {\end{bclogo}}
\newenvironment{any}{}{}

% an algorithm environment to reduce algorithm2e boilerplate
\newenvironment{alg} {
  \begin{algorithm}[H]
  \DontPrintSemicolon
  \SetKwFunction{func}{My-Super-Function}
  \SetKwProg{fn}{}{}{}
  \SetKwRepeat{Do}{do}{while} % do-while macro
  }
  {\end{algorithm}}
% more keywords for algorithm2e
\SetKwInput{returns}{returns}
\SetKwInput{args}{arguments}
\SetKw{yield}{yield}
\SetKw{return}{return}
% get rid of annoying italics in for and if statements
\SetArgSty{textnormal}%{textup}
\SetFuncSty{textnormal}
\SetFuncArgSty{textnormal}
% \SetKwSty{mykwsty}
% \SetDataSty{myvarsty}
% search through https://ctan.ebinger.cc/tex-archive/macros/latex/contrib/algorithm2e/tex/algorithm2e.sty for the full list of commands

% code evaluation results environment
\newenvironment{results}
  {}
  {}

% extensible \vec alternative from https://tex.stackexchange.com/questions/114321/extensible-vec-instead-of-overrightarrow
\makeatletter
\newcommand{\vect}[1]{%
  \vbox{\m@th \ialign {##\crcr
  \vectfill\crcr\noalign{\kern-\p@ \nointerlineskip}
  $\hfil\displaystyle{#1}\hfil$\crcr}}}
\def\vectfill{%
  $\m@th\smash-\mkern-7mu%
  \cleaders\hbox{$\mkern-2mu\smash-\mkern-2mu$}\hfill
  \mkern-7mu\raisebox{-3.81pt}[\p@][\p@]{$\mathord\mathchar"017E$}$}

% from https://tex.stackexchange.com/questions/329170/how-to-do-multiple-lines-within-brace
\providecommand\given{} % ensure it exists
\newcommand\givensymbol[1]{%
  \nonscript\;\delimsize#1\allowbreak\nonscript\;\mathopen{}%
}
\DeclarePairedDelimiterX\Set[1]\{\}{%
  \renewcommand\given{\givensymbol{\vert}}%
  #1%
}