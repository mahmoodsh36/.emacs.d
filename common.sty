\makeatletter%
\@ifclassloaded{beamer}%
  {\usetheme{Antibes}}%
  {\usepackage[margin=0.2in]{geometry}}%
\makeatother%
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{indentfirst}
\usepackage{pgffor}
\usepackage{amssymb}
\usepackage{pifont}
\usepackage{cancel}
\usepackage{amsthm}
\usepackage{polynom}
\usepackage{tikz}
\usepackage[tikz]{bclogo}
\usepackage{listings}
\usepackage[most]{tcolorbox}
\usepackage{forest}
\usepackage{adjustbox}
\usepackage{tikz-3dplot}
\usepackage{mathtools}
\usepackage{pgfplots}
\usetikzlibrary{tikzmark,calc,fit,matrix,arrows,automata,positioning,angles,quotes,trees,graphs,backgrounds,intersections,arrows.meta,bbox,chains,shapes,calligraphy,decorations.pathreplacing}
\usepgfplotslibrary{fillbetween}
\usepackage{centernot}
\usepackage{lmodern}
% \usepackage{physics} % why does it redefine \div?
\usepackage{physics2}
\usepackage[linesnumbered,vlined]{algorithm2e}
\usepackage{algpseudocode}
\usepackage{algorithmicx}
% \usepackage{svg}
% \usepackage{karnaugh-map}
\usepackage{karnaughmap}
\usepackage{bm}
\usepackage{circuitikz}
\usepackage{listofitems}
\usepackage{proof}
% dont enable this its horrible, makes rendering from org-babel not work properly
% \tikzstyle{every picture}+=[remember picture]
\usepackage{enumitem}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{iftex}
\usepackage{turnstile}
\usepackage[normalem]{ulem}
\usepackage{ifthen}
\usepackage{xifthen}
\usepackage{xparse}
\usepackage{pdfpages}
\usepackage{relsize} % for \mathsmaller, \mathlarger
\usepackage{fonttable}
\usepackage{float} % fixes some errors for figure previews in org mode (allows the figure to "float")
% \usepackage{breqn}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{lipsum}
\usepackage{mathrsfs}
\usepackage{newenviron}
\usepackage{upgreek}
\usepackage{bbm}
\usepackage{newpxtext,newpxmath}
\usepackage{cool}

% for venn diagrams (i dont think i need those)
% \usepackage[svgnames]{xcolor}
% \usepackage{venndiagram}

\ifLuaTeX
  % graphdrawing library is only available to luatex
  \usetikzlibrary{graphdrawing}
  \usegdlibrary{force, trees, layered}

  % only usable with lualatex
  \usepackage{fontspec}
  % \usepackage[math-style=ISO, bold-style=ISO]{unicode-math} % this causes lualatex to not find some symbols in files
  \setmainfont{Linux Libertine O}
  % \setmainfont{TeX Gyre Pagella}
  %\setmathfont{TeX Gyre Pagella Math}
  %\setmathfont{TeX Gyre Termes Math}
  %\setmathfont{STIX}
  % \setmainfont{GFS Bodoni}
  % \setmathfont{Asana Math}

  % \setmainfont{Latin Modern Roman}
  % \setmathfont[range=\mathup/{latin,Latin}]{TeX Gyre Heros}
  % \defaultfontfeatures{Ligatures={TeX}}
  % \setmainfont{CMU Serif}
  % \setsansfont{CMU Sans Serif}
  % \setmathfont{Latin Modern Math}

  % \newcommand\brm[1]{\symbf{#1}} % this one symbf from unicode-math works with all symbols, so far (requires lualatex)
  % \else
  % \newcommand\brm[1]{\bm{\mathrm{#1}}} % \bv isnt universal
\fi
\newcommand\brm[1]{\bm{\mathrm{#1}}} % \bv isnt universal

% \usepackage{kpfonts} % better(?) looking fonts, although misses some important chars such as the hyphen

% \setmainlanguage{english}
% \setotherlanguage{greek}
% \newfontfamily\greekfont{GFS Artemisia}[
% Scale=MatchUppercase
% ]

% get \varv from the txfonts package
\DeclareSymbolFont{matha}{OML}{txmi}{m}{it}% txfonts
\DeclareMathSymbol{\varv}{\mathord}{matha}{118}

% matrix derivative notation for vector calculus
\newcommand{\matderiv}[2][]{%
  \ifthenelse{\equal{#1}{}}
  {\ensuremath{\left[\brm{D}#2\right]}}% if #1 is empty
  {\ensuremath{\left[\brm{D}_{#1}#2\right]}}% if #2,#1 not empty
}

% integral notation, https://tex.stackexchange.com/questions/174121/easy-command-or-package-for-properly-formatted-integrals
\makeatletter
\newcommand*{\intf}{%
  \@ifnextchar_{\intf@sub}{%
    \@ifnextchar^{\intf@sup}{%
      \intf@{}{}%
    }%
  }%
}
\def\intf@sub_#1{%
  \@ifnextchar^{%
    \intf@sub@sup{#1}%
  }{%
    \intf@{#1}{}%
  }%
}
\def\intf@sup^#1{%
  \@ifnextchar_{%
    \intf@sup@sub{#1}%
  }{%
    \intf@{}{#1}%
  }%
}
\def\intf@sub@sup#1^#2{\intf@{#1}{#2}}
\def\intf@sup@sub#1_#2{\intf@{#2}{#1}}
\newcommand*{\intf@}[4]{%
  \int
  \ifx\\#1\\\else _{#1}\fi
  \ifx\\#2\\\else ^{#2}\fi
  \!#3\,\mathrm{d}#4%
}
\makeatother

% typesetting partial derivatives flexibly: https://tex.stackexchange.com/questions/22076/can-i-have-a-flexible-partial-derivative-macro/22571#22571
\makeatletter

\newcommand\Der[2]{%
    \begingroup
    \@temptokena{\@gobble}%
    \@tempcnta\z@
    \expandafter\@Der@var#2\relax
    \ensuremath{\frac{\partial
    \ifnum\@tempcnta>\@ne
        ^{\the\@tempcnta}%
    \fi
    #1}{\the\@temptokena}}%
    \endgroup
}

\def\@Der@var#1{%
    \ifx\relax#1\empty\else
        \def\next{\expandafter\@Der@num\expandafter{\the\@tempcntb}{#1}}%
        \afterassignment\next
        \@tempcntb=0%
    \fi
}

\def\@Der@num#1#2{%
    \ifnum#1=\z@
        \advance\@tempcnta by \@ne
        \@temptokena\expandafter{\the\@temptokena\,\partial{#2}}%
    \else
        \advance\@tempcnta by #1\relax
        \@temptokena\expandafter{\the\@temptokena\,\partial{#2}^{#1}}%
    \fi
    \@Der@var
}

\makeatother

% another partial derivative typesetting attempt, https://tex.stackexchange.com/questions/22076/can-i-have-a-flexible-partial-derivative-macro/22571#22571
\makeatletter
\newcommand{\der}[2]{\begingroup
  \@tempswafalse\toks@={}\count@=\z@
  \@for\next:=#2\do
    {\expandafter\check@var\next\@nil
     \advance\count@\der@exp
     \if@tempswa
       \toks@=\expandafter{\the\toks@\,}%
     \else
       \@tempswatrue
     \fi
     \toks@=\expandafter{\the\expandafter\toks@\expandafter\partial\der@var}}%
  \frac{\partial\ifnum\count@=\@ne\else^{\number\count@}\fi#1}{\the\toks@}%
  \endgroup}
\def\check@var{\@ifstar{\mult@var}{\one@var}}
\def\mult@var#1#2\@nil{\def\der@var{#2^{#1}}\def\der@exp{#1}}
\def\one@var#1\@nil{\def\der@var{#1}\chardef\der@exp\@ne}
\makeatother

% alternative to \hyperref to refer to a symbols definition/source
\newcommand{\refdef}[2][]{%
  \textcolor{green}{\hyperref[#1]{#2}}
}

% no space before paragraph (is this desired?)
\setlength{\parindent}{0pt}

% some needed operators to not lose my sanity
\DeclareMathOperator{\spn}{span}
\DeclareMathOperator{\dom}{domain}
\DeclareMathOperator{\ran}{range}
\DeclareMathOperator{\rng}{range}
\DeclareMathOperator{\range}{range}
\DeclareMathOperator{\img}{Im}
\DeclareMathOperator{\adj}{adj}
\DeclareMathOperator{\Var}{Var}
\DeclareMathOperator{\cov}{cov}
\newcommand\dif[1]{\:\mathrm{d}#1}
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}
\DeclareMathOperator{\rank}{rank}
\newcommand{\ihat}{\hat{\textbf{\i}}}
\newcommand{\jhat}{\hat{\textbf{\j}}}
\newcommand{\khat}{\hat{\textbf{k}}}
\newcommand{\rhat}{\hat{\textbf{r}}}
\newcommand{\thetahat}{\boldsymbol{\hat{\theta}}}
\newcommand{\?}{\stackrel{?}{=}}
\newcommand{\cmark}{\text{\ding{51}}}
\newcommand{\xmark}{\text{\ding{55}}}
\renewcommand\Pr{\operatorname{\mathbb{P}}} % for probability function symbol
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator{\vct}{vec}
\newcommand*{\defeq}{\stackrel{\text{def}}{=}} % def on top of equal sign
\DeclareMathOperator{\expc}{\mathbb{E}} % expected value symbol
\DeclareMathOperator{\Mat}{Mat} % Mat symbol for sets of matrices of specific dimensions
\newcommand{\inpr}[2]{\langle #1, #2 \rangle} % inner product symbols, consider also physics' \braket
\newcommand{\textand}{\mathbin{\text{and}}}
\newcommand{\textnot}{\text{ not }}
\newcommand{\textor}{\mathbin{\text{or}}}
\newcommand{\textif}{\text{if }}
\newcommand{\textthen}{\text{ then }}
\newcommand{\textgoto}{\mathbin{\text{goto}}}
\DeclareMathOperator{\graph}{graph} % Mat symbol for sets of matrices of specific dimensions
\newcommand{\angled}[1]{\langle #1 \rangle} % inner product symbols, consider also physics' \braket
\newcommand{\decr}[1]{#1\texttt{-{}-}} % increment of a number
\newcommand{\incr}[1]{#1\texttt{+{}+}} % decrement of a number

% some symbols for cryptography notation (Gen,Enc,Dec), and others
\DeclareMathOperator{\Gen}{Gen}
\DeclareMathOperator{\Enc}{Enc}
\DeclareMathOperator{\Dec}{Dec}
\DeclareMathOperator{\Sign}{Sign}
\DeclareMathOperator{\Vrfy}{Vrfy}
\DeclareMathOperator{\negl}{negl}
\DeclareMathOperator{\cert}{cert}
\newcommand{\privkexp}{\operatorname{PrivK}_{\mathcal{A},\Pi}^{\mathrm{eav}}}
\newcommand{\sigexp}{\operatorname{Sig-Forge}_{\mathcal{A},\Pi}}

\newcommand{\smallspace}{\hspace{5pt}}

% some symbols for relational algebra
\def\ojoin{\setbox0=\hbox{$\bowtie$}%
  \rule[-.02ex]{.25em}{.4pt}\llap{\rule[\ht0]{.25em}{.4pt}}}
\def\leftouterjoin{\mathbin{\ojoin\mkern-5.8mu\bowtie}}
\def\rightouterjoin{\mathbin{\bowtie\mkern-5.8mu\ojoin}}
\def\fullouterjoin{\mathbin{\ojoin\mkern-5.8mu\bowtie\mkern-5.8mu\ojoin}}

% lst
\definecolor{Brown}{cmyk}{0,0.81,1,0.60}
\definecolor{OliveGreen}{cmyk}{0.64,0,0.95,0.40}
\definecolor{CadetBlue}{cmyk}{0.62,0.57,0.23,0}
\definecolor{lightlightgray}{gray}{0.9}
\lstset{
  language=C,                             % Code langugage
  basicstyle=\ttfamily,                   % Code font, Examples: \footnotesize, \ttfamily
  keywordstyle=\color{OliveGreen},        % Keywords font ('*' = uppercase)
  commentstyle=\color{gray},              % Comments font
  numbers=left,                           % Line nums position
  numberstyle=\tiny,                      % Line-numbers fonts
  stepnumber=1,                           % Step between two line-numbers
  numbersep=5pt,                          % How far are line-numbers from code
  backgroundcolor=\color{lightlightgray}, % Choose background color
  tabsize=2,                              % Default tab size
  captionpos=t,                           % Caption-position = bottom
  breaklines=true,                        % Automatic line breaking?
  breakatwhitespace=false,                % Automatic breaks only at whitespace?
  showspaces=false,                       % Dont make spaces visible
  showtabs=false,                         % Dont make tabls visible
  % columns=flexible,                       % Column format
  morekeywords={__global__, __device__},   % CUDA specific keywords
  showstringspaces=false,                 % dont show spaces in strings
  frame=shadowbox,
}
% so that latex doesnt complain about sage not being a language
\lstdefinelanguage{sage}{}

% environments like definition for special blocks, some of them are defined in beamer, so dont load them when the document class is beamer
\makeatletter%
\@ifclassloaded{beamer}%
  {}%
  {\theoremstyle{definition} \newtheorem{definition}{definition}
\newtheorem{my_example}{example}
\newtheorem{assumption}{assumption}
\counterwithin{my_example}{section}
\counterwithin{my_example}{subsection}
\counterwithin{definition}{section}
\counterwithin{definition}{subsection}
\newtheorem{characteristic}{characteristic}
\newtheorem{entailment}{entailment}
\newtheorem{corollary}{corollary}
% \newtheore*{proof}{Proof}
\newtheorem{lemma}{lemma}
\newtheorem{question}{question}
\newtheorem{remark}{remark}
\newtheorem{subquestion}{subquestion}[question]
% \newtheorem{note}{Note}
\newtheorem{answer}{answer}
\counterwithin{answer}{question}
\counterwithin{answer}{subquestion}
\newtheorem{step}{step}[answer]
\newtheorem{problem}{problem}
\newtheorem{solution}{solution}[problem]
\newtheorem{subproblem}{subproblem}[problem]
\newtheorem{task}{task}
\newtheorem{theorem}{theorem}
\newtheorem{axiom}{axiom}
\newtheorem{claim}{claim}
\newtheorem{proposition}{proposition}
\newtheorem{notation}{notation}
\newenvironment{note}
{\begin{bclogo}[logo=\bcinfo, couleurBarre=orange, couleur=lightgray]{ note}}
  {\end{bclogo}}
\newenvironment{attention}
{\begin{bclogo}[logo=\bcattention, couleurBarre=red, noborder=true,
    couleur=red!15]{Important!}}
  {\end{bclogo}}
\newenvironment{any}{}{}
% a dummy environment to group together "stuff"
\newenvironment*{dummyenv}{}{}
\newenvironment*{dummy}{}{}
}%
\makeatother%
\newtheorem{thought}{thought}

% the following snippet auto resizes images to fit properly
% Determine if the image is too wide for the page.
% \makeatletter
% \def\ScaleIfNeeded{%
% \ifdim\Gin@nat@width>\linewidth
%   \linewidth
% \else
%   \Gin@nat@width
% \fi
% }
%   \makeatother
% %   Resize figures that are too wide for the page.
%   \let\oldincludegraphics\includegraphics
%   \renewcommand\includegraphics[2][]{%
%   \oldincludegraphics[width=\ScaleIfNeeded]{#2}
% }

%   brace to group lines of code for a quote
\newcommand*{\addbrace}[4]{%
  \begin{tikzpicture}[overlay, remember picture]
    \draw[decoration={brace,amplitude=0.5em}, decorate, thick]
    ($(#3)!(#1.north)!($(#3)-(0,1)$)$) --
    ($(#3)!(#2.south)!($(#3)-(0,1)$)$)
    node[right=0.2cm, text width=5cm, pos=0.5, anchor=west] {#4};
  \end{tikzpicture}
}%

% an algorithm environment to reduce algorithm2e boilerplate
\newenvironment{alg} {
  \begin{algorithm}[H]
    \DontPrintSemicolon
    \SetKwFunction{func}{My-Super-Function}
    \SetKwProg{fn}{}{}{}
    \SetKwRepeat{Do}{do}{while} % do-while macro
  }
  {\end{algorithm}}
% alias to above with no line numbering
\NewEnviron{algn} {{\LinesNumberedHidden\begin{alg}
      \BODY
    \end{alg}}}
% more keywords for algorithm2e
\SetKwInput{returns}{returns}
\SetKwInput{args}{arguments}
\SetKw{yield}{yield}
\SetKw{from}{from}
\SetKw{return}{return}
\SetKw{goto}{goto}
% get rid of annoying italics in for and if statements
\SetArgSty{textnormal}%{textup}
\SetFuncSty{textnormal}
\SetFuncArgSty{textnormal}
% \SetKwSty{mykwsty}
% \SetDataSty{myvarsty}
% search through https://ctan.ebinger.cc/tex-archive/macros/latex/contrib/algorithm2e/tex/algorithm2e.sty for the full list of commands

% code evaluation results environment
\newenvironment{results}
{}
{}

% extensible \vec alternative from https://tex.stackexchange.com/questions/114321/extensible-vec-instead-of-overrightarrow
\makeatletter
\newcommand{\vect}[1]{%
  \vbox{\m@th \ialign {##\crcr
      \vectfill\crcr\noalign{\kern-\p@ \nointerlineskip}
      $\hfil\displaystyle{#1}\hfil$\crcr}}}
\def\vectfill{%
  $\m@th\smash-\mkern-7mu%
  \cleaders\hbox{$\mkern-2mu\smash-\mkern-2mu$}\hfill
  \mkern-7mu\raisebox{-3.81pt}[\p@][\p@]{$\mathord\mathchar"017E$}$}

% from https://tex.stackexchange.com/questions/329170/how-to-do-multiple-lines-within-brace
\providecommand\given{} % ensure it exists
\newcommand\givensymbol[1]{%
  \nonscript\;\delimsize#1\allowbreak\nonscript\;\mathopen{}%
}
\DeclarePairedDelimiterX\Set[1]\{\}{%
  \renewcommand\given{\givensymbol{\vert}}%
  #1%
}
\newcommand{\set}{\Set*}

% for karnaughmap package
\define@cmdkey{karnaughmap}{dontcare}[\phi]{} % change default dontcare symbol, doesnt work?

% two-headed two-sided arrows
% https://tex.stackexchange.com/questions/192709/does-twoheadleftrightarrow-exist-how-to-write-my-own
\newcommand*{\twoheadleftrightarrow}{%
  \twoheadleftarrow
  \mathrel{\mkern-15mu}%
  \twoheadrightarrow
}
\makeatletter
\newcommand*{\xtwoheadleftrightarrow}[2][]{%
  \ext@arrow 99{10}{10}\twoheadleftrightarrowfill@{#1}{#2}%
}
\newcommand*{\twoheadleftrightarrowfill@}{%
  \arrowfill@\twoheadleftarrow\relbar\twoheadrightarrow
}
\makeatother

% rewrite some macros from physics to avoid using the package itself
\newcommand\pmqty[1]{\begin{pmatrix}#1\end{pmatrix}}
\newcommand\bmqty[1]{\begin{bmatrix}#1\end{bmatrix}}

% absolute value macro, |var|
\delimitershortfall-1sp
\newcommand\abs[1]{\left|#1\right|}
% norm macro, https://tex.stackexchange.com/questions/107186/how-to-write-norm-which-adjusts-its-size
\DeclarePairedDelimiterX{\norm}[1]{\lVert}{\rVert}{#1}

% others i found here https://tex.stackexchange.com/questions/471532/alternatives-to-the-physics-package
% \DeclarePairedDelimiter{\bra}{\langle}{\rvert}%
% \DeclarePairedDelimiter{\ket}{\lvert}{\rangle}%
% \DeclarePairedDelimiterX\innerp[2]{\langle}{\rangle}{#1\delimsize\vert\mathopen{}#2}%
% \DeclarePairedDelimiterX\braket[2]{\langle}{\rangle}{#1\delimsize\vert\mathopen{}#2}%
% \DeclarePairedDelimiterX\braketOP[3]{\langle}{\rangle}{#1\,\delimsize\vert\,\mathopen{}#2\,\delimsize\vert\,\mathopen{}#3}%
% \DeclarePairedDelimiterX\ketbra[2]{\lvert}{\rvert}{#1\delimsize\rangle\!\delimsize\langle#2}%
% \DeclarePairedDelimiterX\outerp[2]{\lvert}{\rvert}{#1\delimsize\rangle\!\delimsize\langle#2}%
% \DeclarePairedDelimiterX\projector[1]{\lvert}{\rvert}{#1\delimsize\rangle\!\delimsize\langle#1}%

% dot above minus (for monus etc), https://tex.stackexchange.com/questions/114188/special-character-dot-over-dash
\makeatletter
\newcommand{\dotminus}{\mathbin{\text{\@dotminus}}}

\newcommand{\@dotminus}{%
  \ooalign{\hidewidth\raise1ex\hbox{.}\hidewidth\cr$\m@th-$\cr}%
}
\makeatother

% for vertical equal signs, https://tex.stackexchange.com/questions/100538/vertical-equal-sign
\newcommand{\verteq}{\rotatebox{90}{\(\,=\)}}
\newcommand{\equalto}[2]{\underset{\scriptstyle\overset{\mkern4mu\verteq}{#2}}{#1}}

% Z with a middle stroke, https://tex.stackexchange.com/questions/350453/z-with-a-stroke-through-it
\newcommand{\Zstroke}{%
  \text{\ooalign{\hidewidth\raisebox{0.2ex}{--}\hidewidth\cr$Z$\cr}}%
}
\newcommand{\zstroke}{%
  \text{\ooalign{\hidewidth -\kern-.3em-\hidewidth\cr$z$\cr}}%
}

% for symbols similar to \uplus but with multiplication, https://tex.stackexchange.com/questions/417895/how-to-typeset-utimes-akin-to-uplus
\newcommand\utimes{\mathbin{\ooalign{$\cup$\cr%
   \hfil\raise0.42ex\hbox{$\scriptscriptstyle\times$}\hfil\cr}}}
\newcommand\bigutimes{\mathop{\ooalign{$\bigcup$\cr%
   \hfil\raise0.36ex\hbox{$\scriptscriptstyle\boldsymbol{\times}$}\hfil\cr}}}

% some more macros for convenience
\newcommand{\rnumset}{\mathbb{R}} % for the set of real numbers
\newcommand{\cnumset}{\mathbb{C}} % for the set of complex numbers
\newcommand{\qnumset}{\mathbb{Q}} % for the set of rational numbers
\newcommand{\vsfield}{\refdef[def-F]{\mathbb{F}}} % for the "field" of a vector space which may stand for R or C (reals or complex nums)